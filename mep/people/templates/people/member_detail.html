{% extends 'base.html' %}
{% load mep_tags %}

{% block page-subtitle %}{{ member.name }} · Library Members · {% endblock %}

{% block js %}
<script type="application/ld+json">{{ page_jsonld|safe }}</script>
<script src="https://d3js.org/d3.v5.js"></script>
{% endblock %}

{% block header %}
{% include 'snippets/header.html' with title=member.name style="detail" %}
{% endblock %}

{% block main-style %}tabbed white{% endblock %}

{% block content %}
{% include 'snippets/breadcrumbs.html' %}
<nav class="tabs" aria-label="sections">
    <li class="tab" aria-selected="true">
        <a href="{% url 'people:member-detail' pk=member.pk %}">biography</a>
    </li>
    <li class="tab">
        <a href="{% url 'people:membership-activities' pk=member.pk %}">activities</a>
    </li>
    <li class="tab">
        <a href="#">cards</a>
    </li>
</nav>
<section class="biography" aria-label="biography">
    <div class="details">
        {% include 'people/snippets/member_result.html' %}
    </div>

    <div class="timeline">
    <svg width="1440" height="800"></svg>
        <script>
            const data = {{ timeline|json }}
            console.log('timeline data: ', data)




var x = d3.scaleTime()
    // whole timeline
    .domain([new Date(1919, 1, 1), new Date(1942, 12, 31)])
    .range([0, 911]);

var axis = d3.axisTop(x);

d3.select("svg")
    .attr("width", 1440)
    .attr("height", 800)
  .append("g")
    .attr("transform", "translate(0,30)")
    .call(axis)
    .call(g => g.selectAll(".tick line")
        .attr("stroke", 'black')
        .attr("y2", 150)
        .attr("y1", 0))

// start date
d3.select('svg').append('g')
    .attr('class', 'subscription-start')
  .selectAll('circle')
  .data(data.membership_activities)
  .join(
    enter => enter.append("circle")
                    .attr('class', 'start-date')
                    .attr('cx', function(d) {
                      return x(new Date(d.startDate))
                     })
                    .attr('cy', 60)
                    .attr('r', 3)
                    .attr("fill", "black")
  )
// end date
d3.select('svg').append('g')
    .attr('class', 'subscription-end')
  .selectAll('circle')
  .data(data.membership_activities)
  .join(
    enter => enter.append("circle")
                    .attr('class', 'end-date')
                    .attr('cx', function(d) {
                      return x(new Date(d.endDate))
                     })
                    .attr('cy', 60)
                    .attr('r', 3)
                    .attr("fill", "black")
  )

// line
d3.select('svg').append('g')
    .attr('class', 'subscription-lines')
  .selectAll('line')
  .data(data.membership_activities)
  .join(
    enter => enter.append("line")
                    .attr('class', 'subscription')
                    .attr('x1', function(d) {
                      return x(new Date(d.startDate))
                     })
                    .attr('x2', function(d) {
                      return x(new Date(d.endDate))
                     })
                    .attr('y1', 60)
                    .attr('y2', 60)
                    .attr("stroke", "black")
  )


d3.select('svg').append('g')
    .attr('class', 'activityrange-bars')
  .selectAll('bar')
  .data(data.activity_ranges)
  .join(
    enter => enter.append("rect")
                    .attr('class', 'overallActivities')
                    .attr('x', function(d) {
                      return x(new Date(d.startDate))
                     })
                    .attr('y', 60)
                     // return y(new Number(d.bookEventCount))
                   //  })
                    .attr("fill", "#231F20")
                    .attr("opacity", "0.2")
                    .attr("width", function (d) {
                        return x(new Date(d.endDate)) - x(new Date(d.startDate))
                    })//function(d) {)
                    .attr("height", 121)
    )
// bar


var svgheight = 181;

d3.select('svg').append('g')
    .attr('class', 'borrowing-bars')
  .selectAll('bar')
  .data(data.book_activities)
  .join(
    enter => enter.append("rect")
                    .attr('class', 'borrowing')
                    .attr('x', function(d) {
                      return x(new Date(d.startDate))
                     })
                    .attr('y', function (d) {
                        return svgheight - d.count
                    })
                    .attr("fill", "#47C2C2")
                    .attr("opacity", "0.8")
                    .attr("width", 5)
                    .attr("height",function (d) {
                        return d.count
                 })
    )
        </script>
    </div>



    <div class="map"></div>
</section>
{% endblock %}